% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/geocode.R
\name{geocode}
\alias{geocode}
\title{Geolocaliza endereços no Brasil}
\usage{
geocode(
  enderecos,
  campos_endereco = definir_campos(),
  resultado_completo = FALSE,
  resultado_sf = FALSE,
  verboso = TRUE,
  cache = TRUE,
  n_cores = 1
)
}
\arguments{
\item{enderecos}{Um \code{data.frame}. Os endereços a serem geolocalizados. Cada
coluna deve representar um campo do endereço.}

\item{campos_endereco}{Um vetor de caracteres. A correspondência entre cada
campo de endereço e o nome da coluna que o descreve na tabela \code{enderecos}.
A função \code{\link[=definir_campos]{definir_campos()}} auxilia na criação deste vetor e realiza
algumas verificações nos dados de entrada. Campos de endereço passados
como \code{NULL} serão ignorados, e a função deve receber pelo menos um campo
não nulo, além  dos campos \code{"estado"} e \code{"municipio"}, que são
obrigatórios. Note que o campo  \code{"localidade"} é equivalente a 'bairro'.}

\item{resultado_completo}{Lógico. Indica se o output deve incluir colunas
adicionais, como o endereço encontrado de referência. Por padrão, é \code{FALSE}.}

\item{resultado_sf}{Lógico. Indica se o resultado deve ser um objeto espacial
da classe \code{sf}. Por padrão, é \code{FALSE}, e o resultado é um \code{data.frame} com
as colunas \code{lat} e \code{lon}.
adicionais, como o endereço encontrado de referência. Por padrão, é \code{FALSE}.}

\item{verboso}{Um valor lógico. Indica se barras de progresso e mensagens
devem ser exibidas durante o download dos dados do CNEFE e a geocodificação
dos endereços. O padrão é \code{TRUE}.}

\item{cache}{Um valor lógico. Indica se os dados do CNEFE devem ser salvos ou
lidos do cache, reduzindo o tempo de processamento em chamadas futuras. O
padrão é \code{TRUE}. Quando \code{FALSE}, os dados do CNEFE são baixados para um
diretório temporário.}

\item{n_cores}{Um número. O número de núcleos de CPU a serem utilizados no
processamento dos dados. O padrão é 1.}
}
\value{
Retorna o \code{data.frame} de input \code{enderecos} adicionado das colunas de
latitude (\code{lat}) e longitude (\code{lon}), bem como as colunas (\code{precisao} e
\code{tipo_resultado}) que indicam o nível de precisão e o tipo de resultado.
Alternativamente, o resultado pode ser um objeto \code{sf}.
}
\description{
Geocodifica endereços brasileiros com base nos dados do CNEFE. Os endereços
de input devem ser passados como um \code{data.frame}, no qual cada coluna
descreve um campo do endereço (logradouro, número, cep, etc). O resuldos dos
endereços geolocalizados podem seguir diferentes níveis de precisão. Consulte
abaixo a seção "Detalhes" para mais informações. As coordenadas de output
utilizam o sistema de referência geodésico "SIRGAS2000", CRS(4674).
}
\details{
Precisão dos resultados:

Os resultados do \strong{{geocodebr}} são classificados em seis amplas categorias de \code{precisao}:
\itemize{
\item "numero"
\item "numero_interpolado"
\item "rua"
\item "cep"
\item "localidade"
\item "municipio"
\item \code{NA} (não encontrado)
}

Cada nível de precisão pode ser desagregado em tipos de correspondência mais
refinados.
}
\section{Tipos de resultados}{
A coluna \code{match_type} fornece informações mais detalhadas sobre como
exatamente cada endereço de entrada foi encontrado no CNEFE. Em cada
categoria,  o \strong{{geocodebr}} calcula a média da latitude e longitude dos
endereços incluídos no CNEFE que correspondem ao endereço de entrada, com
base em combinações de diferentes campos. No caso mais rigoroso, por exemplo,
a função encontra uma correspondência determinística para todos os campos de
um dado endereço (\code{"estado"}, \code{"municipio"}, \code{"logradouro"}, \code{"numero"},
\code{"cep"}, \code{"localidade"}). Pense, por exemplo, em um prédio com vários
apartamentos que correspondem ao mesmo endereço de rua e número. Nesse caso,
as coordenadas dos apartamentos podem diferir ligeiramente, e o
\strong{{geocodebr}} calcula a média dessas coordenadas. Em um caso menos rigoroso,
no qual apenas os campos (\code{"estado"}, \code{"municipio"}, \code{"logradouro"},
\code{"localidade"}) são encontrados, o \strong{{geocodebr}} calcula as coordenadas
médias de todos os endereços no CNEFE ao longo daquela rua e que se encontram
na mesma localidade/bairro. Assim, as coordenadas de resultado tendem a ser o
ponto médio do trecho daquela rua que passa dentro daquela localidade/bairro.

A lista completa dos níveis de precisão (\code{precisao}), suas categorias de tipo
de correspondência (\code{tipo_resultado}) e os campos de endereço considerados em
cada categoria estão descritos abaixo:
\itemize{
\item precisao: \strong{"numero"}
\itemize{
\item tipo_resultado:
\item en01: logradouro, numero, cep e localidade
\item en02: logradouro, numero e cep
\item en03: logradouro, numero e localidade
\item en04: logradouro e numero
\item pn01: logradouro, numero, cep e localidade
\item pn02: logradouro, numero e cep
\item pn03: logradouro, numero e localidade
\item pn04: logradouro e numero
}
\item precisao: \strong{"numero_aproximado"}
\itemize{
\item tipo_resultado:
\item ei01: logradouro, numero, cep e localidade
\item ei02: logradouro, numero e cep
\item ei03: logradouro, numero e localidade
\item ei04: logradouro e numero
\item pi01: logradouro, numero, cep e localidade
\item pi02: logradouro, numero e cep
\item pi03: logradouro, numero e localidade
\item pi04: logradouro e numero
}
\item precisao: \strong{"logradouro"} (quando o número de entrada está faltando 'S/N')
\itemize{
\item tipo_resultado:
\itemize{
\item er01: logradouro, cep e localidade
\item er02: logradouro e cep
\item er03: logradouro e localidade
\item er04: logradouro
\item pr01: logradouro, cep e localidade
\item pr02: logradouro e cep
\item pr03: logradouro e localidade
\item pr04: logradouro
}
}
\item precisao: \strong{"cep"}
\itemize{
\item tipo_resultado:
\itemize{
\item ec01: municipio, cep, localidade
\item ec02: municipio, cep
}
}
\item precisao: \strong{"localidade"}
\itemize{
\item tipo_resultado:
\itemize{
\item eb01: municipio, localidade
}
}
\item precisao: \strong{"municipio"}
\itemize{
\item tipo_resultado:
\itemize{
\item em01: municipio
}
}
}

\emph{\strong{Nota:}} As categorias de \code{match_type} que começam com 'p' utilizam
correspondência probabilística do campo logradouro, enquanto os tipos que
começam com 'e' utilizam apenas correspondência determinística. \strong{As
categorias de \code{tipo_resultado} que usam correspondência probabilística ainda
não estão implementadas no pacote geocodebr}.
}

\examples{
\dontshow{if (identical(tolower(Sys.getenv("NOT_CRAN")), "true")) (if (getRversion() >= "3.4") withAutoprint else force)(\{ # examplesIf}

# ler amostra de dados
data_path <- system.file("extdata/small_sample.csv", package = "geocodebr")
input_df <- read.csv(data_path)

fields <- geocodebr::definir_campos(
  logradouro = "nm_logradouro",
  numero = "Numero",
  cep = "Cep",
  localidade = "Bairro",
  municipio = "nm_municipio",
  estado = "nm_uf"
)

df <- geocodebr::geocode(
  enderecos = input_df,
  campos_endereco = fields,
  verboso = FALSE
  )

head(df)
\dontshow{\}) # examplesIf}
}
